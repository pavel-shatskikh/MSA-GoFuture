# Общее описание

- Данные изолируются по доменам (Booking, Pricing и тд).
- Postgres через отдельные схемы или выделять отдельную БД для крупных партнеров.
- ClickHouse и Redis отдельные для партнера.
- Для кафки топики с префиксом тенанта + уровень разграничение доступа.
- Для IAM/SSO используем Keycloak с разграничением доступов/ролей.
- В JWT токенах прописываем tenant_id, roles, scopes, проверяем в API Gateway.
- При взаимодействии сервисов можно использовать mTLS (сертификаты храним в Vault + алертинг на протухание сертификатов)
- Для онбординга отдельная админка (портал), где оператор управляет квотами, секретами, доступами, созданием инфры (
  вручную через заявки или автоматизировано), дашбордами с метриками, видит аудит и тд.
- Метрики обрабатываются через стандартные средства, отличие в том что добавляется tenant_id для разделения.

# Таблица с выбором ролей и необходимыми уровнями доступа к данным

| Роль                          | Область (Scope)                      | Перс данные                      | Доступы                                                | Функционал                                                          | Интеграции/SSO                          |
|-------------------------------|--------------------------------------|----------------------------------|--------------------------------------------------------|---------------------------------------------------------------------|-----------------------------------------|
| Partner Admin                 | Свой тенант                          | Полный + аудит                   | Read/Write к конфигу, витринам своего тенанта          | Управление пользователями, фичфлаги, вебхуки, лимиты в рамках квоты | Федерация с их IdP, управление группами |
| Partner Operator/Dispatcher   | Свой тенант                          | Маскировано по принципу минимума | Read для операций, ограниченный Write (заказы, отмены) | Операционные панели, очереди, SLA                                   | SSO                                     |
| Partner Finance               | Свой тенант                          | Без явных PAN                    | Read платежных отчётов, аггрегаты                      | Экспорт отчётов                                                     | SSO                                     |
| Partner Analyst               | Свой тенант                          | Маскирование                     | Read к ClickHouse (db-per-tenant) и BI                 | Создание/просмотр дашбордов в своей папке                           | SSO                                     |
| GoFuture Support (Scoped)     | Конкретный тенант (временный доступ) | По запросу + маскирование        | Read-only                                              | Диагностика инцидентов                                              | SSO, Just-In-Time                       |
| GoFuture Ops/SRE              | Все тенанты (платформа)              | Без доступа по умолчанию         | Read метрик/логов платформы, ограниченные K8s/DB       | Провиженинг, DR/BAU                                                 | mTLS + break-glass процедура            |
| Service Account (per-service) | Свой сервис/тенант                   | Недоступно                       | Scoped tokens, ACL                                     | Pub/Sub Kafka, CRUD в своей БД                                      | mTLS + short-lived                      |
